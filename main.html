<!DOCTYPE html>
<html>

	
<body>
	
<script src="https://aframe.io/releases/0.3.0/aframe.min.js"></script>
<script src="https://cdn.rawgit.com/AltspaceVR/AltspaceSDK/v2.0.2/dist/altspace.min.js"></script>
<script src="https://cdn.rawgit.com/mrdoob/three.js/r84/build/three.min.js"></script>
<script src="../../dist/altspace.js"></script>
<script src="https://sdk.altvr.com/libs/altspace.js/2.4.0/altspace.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/nunjucks/3.0.0/nunjucks.min.js"></script>
<script src="https://rawgit.com/ngokevin/kframe/a1df8fc01514e509ba6d39c964254a1f1043b12b/dist/kframe.min.js"></script>

<!-- set up the scene -->
<a-scene altspace sync-system='app: theater; author: greeny3ny'>
	
    <a-assets>

	<a-asset-item id="object" src="https://greeny3ny.github.io/models/objects/theater.obj"></a-asset-item>
	<a-asset-item id="material" src="https://greeny3ny.github.io/models/materials/theater.mtl"></a-asset-item>
	<a-asset-item id="theater" src="https://greeny3ny.github.io/models/dae/theater.dae"></a-asset-item>
	<a-asset-item id="curTex" src="https://greeny3ny.github.io/theater/assets/curtain.png"></a-asset-item>

  	</a-assets>

	<!--<a-entity n-mesh-collider="type:environment" position="37 0 -28" rotation="0 0 0" scale="1 1 1" obj-model="obj: #object; mtl: #material"></a-entity>
<!--
	<a-box n-mesh-collider="type:environment" depth="2" height="2" width="2" position='2 0 2'>-->

	<a-entity n-mesh-collider="type:environment" position="0 0 0" rotation="0 0 0" scale="1 1 1" collada-model="#theater"></a-entity>
	
	<a-entity id="curt1" geometry="primitive:box" material="shader: flat; src: #curTex" position="-8 10 9.5" scale="0.1 18 19" >
		<a-animation begin="moveCurtain1" easing="ease-in" attribute="position" from="-8 10 9.5" to="-8 10 30"  sync="ownOn:moveCurtain1" sync-transform></a-animation>
		<a-animation begin="moveCurtainB1" easing="ease-in" attribute="position" from="-8 10 30" to="-8 10 9.5"  sync="ownOn:moveCurtainB1" sync-transform></a-animation>
	</a-entity>
	
	<a-entity id="curt2" geometry="primitive:box" material="shader: flat; src: #curTex" position="-8 10 -9.5" scale="0.1 18 19" >
		<a-animation begin="moveCurtain2" easing="ease-in" attribute="position" from="-8 10 -9.5" to="-8 10 -30"  sync="ownOn:moveCurtain2" sync-transform></a-animation>
		<a-animation begin="moveCurtainB2" easing="ease-in" attribute="position" from="-8 10 -30" to="-8 10 -9.5" sync="ownOn:moveCurtainB2" sync-transform ></a-animation>
	</a-entity>
	
	
</a-scene>
 
 
</body>

<script>
	var scene = document.querySelector('a-scene');
	var sim = new altspace.utilities.Simulation();
	var boxGeo = new THREE.BoxGeometry(1, 1, 1);
	var material = new THREE.MeshBasicMaterial( { color: 0xffff00 } );
	var box1 = new THREE.Mesh(boxGeo, material);
	var curtOpen = false; //are the curtains open?
	box1.position.set(0, 0, 0);
	
	box1.addEventListener('cursordown', function(){
		
		if (!curtOpen){
			document.querySelector('#curt1').emit('moveCurtain1');
			document.querySelector('#curt2').emit('moveCurtain2');
			curtOpen = true;
		} else {
			document.querySelector('#curt1').emit('moveCurtainB1');
			document.querySelector('#curt2').emit('moveCurtainB2');
			curtOpen = false;
		}
	});
	
	sim.scene.add(box1);

</script>

</html>
